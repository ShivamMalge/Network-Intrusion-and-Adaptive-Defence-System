"""
Vulnerability Entity Phase 2.

Responsibility boundaries:
- Represents discrete host flaws and zero-day opportunities.
- Maintains zero-day revelation state.

Mutation constraints:
- Attributes other than `revealed` must remain immutable.
"""

from vulnerabilities.privilege_model import PrivilegeLevel


class Vulnerability:
    """
    Representation of discrete host flaws and zero-day opportunities.
    """

    def __init__(self, vuln_id: str, severity: float, required_privilege: PrivilegeLevel, zero_day: bool):
        self._vuln_id = vuln_id
        self._severity = max(0.0, min(10.0, severity))
        self._required_privilege = required_privilege
        self._zero_day = zero_day
        self._revealed = not zero_day

    @property
    def vuln_id(self) -> str:
        return self._vuln_id

    @property
    def severity(self) -> float:
        return self._severity

    @property
    def required_privilege(self) -> PrivilegeLevel:
        return self._required_privilege

    @property
    def zero_day(self) -> bool:
        return self._zero_day

    @property
    def revealed(self) -> bool:
        return self._revealed

    def is_visible(self) -> bool:
        """
        Check if the vulnerability is visible to the defender.
        Zero-days remain hidden until explicitly revealed.
        """
        return self._revealed

    def reveal(self) -> None:
        """Reveal a zero-day vulnerability to make it visible."""
        self._revealed = True

    def __repr__(self) -> str:
        return (f"Vulnerability(id='{self._vuln_id}', severity={self._severity}, "
                f"req_priv={self._required_privilege.name}, zero_day={self._zero_day}, "
                f"revealed={self._revealed})")
